# Economy v3 — Redesign Fame Sinks & Tier Progression

**Дата:** 2026-02-08
**Статус:** Утверждено, в реализации

---

## Проблема

1. **Тиры заблокированы Fame**: юзер тратит fame на синки → не хватает на unlock тира → не может депозитить больше → проект теряет потенциальные депозиты
2. **Overclock убыточен для казны**: юзер платит $12.50, казна выплачивает +$27.86 доп. yield. Чистый убыток $15.36 за активацию
3. **Extend Life убыточен**: юзер платит $30, казна выплачивает +$111.43. Убыток $81.43
4. **$ цены overclock сломаны**: отрицательный ROI для юзера с тира 3+ (при 12ч coinbox)

## Ключевое правило

```
Фича увеличивает yield?  → УБЫТОК для казны → УБРАТЬ
Фича НЕ трогает yield?   → плата = ЧИСТЫЙ ДОХОД → ОСТАВИТЬ/ДОБАВИТЬ
```

---

## Решения

### 1. Auto-unlock тиров по totalFameEarned

**Было:** юзер тратит fame на разблокировку тиров (250-45,000⚡)
**Стало:** тиры разблокируются автоматически когда totalFameEarned достигает порога

Пороги (кумулятивные суммы текущих unlock costs):

| Тир | Порог totalFameEarned |
|-----|----------------------|
| 1   | 0 (free)             |
| 2   | 250                  |
| 3   | 750                  |
| 4   | 1,750                |
| 5   | 3,750                |
| 6   | 7,750                |
| 7   | 15,250               |
| 8   | 29,250               |
| 9   | 55,250               |
| 10  | 100,250              |

- Fame НЕ тратится на unlock — только totalFameEarned (lifetime) определяет доступ
- Юзер свободно тратит текущий баланс fame на синки
- Тир разблокируется мгновенно при достижении порога (посреди цикла)

### 2. Покупка доступа к тиру за $ (замена Overclock)

**Было:** Overclock (+50% к клейму) — создаёт доп. yield, убыточен для казны
**Стало:** мгновенная разблокировка тира за 10% от цены машины

Два пути к тиру:
- **Бесплатный**: играй → totalFameEarned растёт → порог достигнут → открыто
- **Платный**: заплати 10% от цены тира → открыто сразу

| Unlock | Цена тира | Fee (10%) |
|--------|----------|-----------|
| → Tier 2 | $30 | $3 |
| → Tier 3 | $75 | $7.50 |
| → Tier 4 | $200 | $20 |
| → Tier 5 | $500 | $50 |
| → Tier 6 | $1,500 | $150 |
| → Tier 7 | $4,000 | $400 |
| → Tier 8 | $12,000 | $1,200 |
| → Tier 9 | $35,000 | $3,500 |
| → Tier 10 | $100,000 | $10,000 |

**Экономика для казны:** чистый доход, yield не меняется.
**Экономика для юзера:** $50 за мгновенный доступ к Tier 5, который принесёт $280 прибыли. Очевидное решение.

### 3. Speed Up (замена Extend Life)

**Было:** Extend Life (+1 день дохода) — создаёт доп. yield, убыточен для казны
**Стало:** Speed Up — ускорение цикла машины, yield тот же

Механика:
- Активируется на конкретную машину
- Сокращает оставшееся время цикла на N дней
- ratePerSecond пропорционально увеличивается → yield тот же
- Нет ограничения на максимальный skip
- Цена: **1% от цены машины за каждый день ускорения**
- Оплата: $ или fame

| Тир | Машина | -1 день | -2 дня | -3 дня |
|-----|--------|---------|--------|--------|
| 1 | $10 | $0.10 | $0.20 | — |
| 2 | $30 | $0.30 | $0.60 | — |
| 3 | $75 | $0.75 | $1.50 | $2.25 |
| 4 | $200 | $2 | $4 | $6 |
| 5 | $500 | $5 | $10 | $15 |
| 6 | $1,500 | $15 | $30 | $45 |
| 7 | $4,000 | $40 | $80 | $120 |
| 8 | $12,000 | $120 | $240 | $360 |
| 9 | $35,000 | $350 | $700 | $1,050 |
| 10 | $100,000 | $1,000 | $2,000 | $3,000 |

Fame цены: $ price × 2.5 × (fame_per_hour[tier] / income_per_hour[tier]) ... или проще: рассчитать через часы пассивного фарма.

**Speed Up fame price** = FAME_PER_HOUR[tier] × 10 за каждый день (10ч пассивного фарма):

| Тир | Fame/ч | -1д (⚡) | -2д (⚡) | -3д (⚡) |
|-----|--------|---------|---------|---------|
| 1 | 3 | 30 | 60 | — |
| 2 | 5 | 50 | 100 | — |
| 3 | 8 | 80 | 160 | 240 |
| 4 | 12 | 120 | 240 | 360 |
| 5 | 18 | 180 | 360 | 540 |
| 6 | 28 | 280 | 560 | 840 |
| 7 | 42 | 420 | 840 | 1,260 |
| 8 | 65 | 650 | 1,300 | 1,950 |
| 9 | 100 | 1,000 | 2,000 | 3,000 |
| 10 | 150 | 1,500 | 3,000 | 4,500 |

**ROI для юзера (Tier 5, skip 2 дня за $10):**
```
Compound value: получаешь $780 на 2 дня раньше → реинвест → ~$50-60 доп. прибыли
Cost: $10
ROI: ~450%
```

**Экономика для казны:** чистый доход, yield не меняется.

### 4. Что удаляется

| Удаляем | Причина |
|---------|---------|
| OVERCLOCK_LEVELS | Заменён на Tier Unlock Purchase |
| OVERCLOCK_FORTUNE_PRICES | Убыточен для казны |
| OVERCLOCK_FAME_PRICES | Убыточен для казны |
| FAME_UNLOCK_COST_BY_TIER | Заменён на auto-unlock по totalFameEarned |
| Extend Life | Заменён на Speed Up |

### 5. Что остаётся без изменений

| Синк | Механика | Казне |
|------|----------|-------|
| Collector | Hire + 5% salary | Чистый доход + yield ↓ |
| Колесо Фортуны | 61% house edge | Чистый доход |
| City Tax | 5-50% на вывод | Чистый доход |
| Coin Box апгрейд | % от машины | Чистый доход |
| Аукцион/Ломбард | Комиссии 10-75% | Чистый доход |
| Reinvest Reduction | -35..90% повторный тир | Yield ↓ |

### 6. Fame pricing (×2.5 для оставшихся синков)

Collector fame prices увеличиваются ×2.5:

| Тир | Текущий (⚡) | Новый ×2.5 (⚡) |
|-----|------------|----------------|
| 1 | 15 | 38 |
| 2 | 25 | 63 |
| 3 | 40 | 100 |
| 4 | 60 | 150 |
| 5 | 90 | 225 |
| 6 | 140 | 350 |
| 7 | 210 | 525 |
| 8 | 325 | 813 |
| 9 | 500 | 1,250 |
| 10 | 750 | 1,875 |

Формула: `FAME_PER_HOUR[tier] × 12.5` (вместо ×5)

---

## Revenue Model (на 1 активного юзера)

### Кит 1→10 с полным usage:
```
Tier unlock fees (10%):   $16,335
Speed Up все циклы:       $6,000-8,000
Collector все циклы:      $11,000+
Колесо (активный):        $5,000+
City Tax:                 ~$3,500-10,000
──────────────────────────────────────────
Итого доход с 1 кита:     ~$42,000-51,000
```

### Средний юзер (Tier 1→5):
```
Tier unlock fees:         $80
Speed Up:                 $50-100
Collector:                $100
Колесо:                   $200+
City Tax:                 ~$84
──────────────────────────────────────────
Итого:                    ~$500-600
```

---

## Изменения в коде

### shared/constants/fame.ts
- [ ] Удалить: OVERCLOCK_LEVELS, OVERCLOCK_FORTUNE_PRICES, OVERCLOCK_FAME_PRICES, getOverclockFortuneCost, getOverclockFameCost
- [ ] Удалить: FAME_UNLOCK_COST_BY_TIER, getFameUnlockCost
- [ ] Добавить: TIER_UNLOCK_FEE_PERCENT = 0.10
- [ ] Добавить: SPEED_UP_COST_PERCENT_PER_DAY = 0.01
- [ ] Добавить: SPEED_UP_FAME_HOURS_PER_DAY = 10
- [ ] Добавить: FAME_AUTO_UNLOCK_THRESHOLDS (кумулятивные пороги)
- [ ] Добавить: COLLECTOR_HIRE_FAME_MULTIPLIER = 2.5 (вместо 1.0)
- [ ] Добавить: helper функции calculateSpeedUpCost(), calculateTierUnlockFee()

### shared/constants/tiers.ts
- [ ] Без изменений в тирах
- [ ] Удалить всё связанное с extend life (если есть)

### apps/api/src/modules/fame/fame.service.ts
- [ ] Удалить: unlockTier() (трата fame)
- [ ] Добавить: checkAutoUnlock() — проверяет totalFameEarned и обновляет maxTierUnlocked
- [ ] Вызывать checkAutoUnlock() при каждом earnFame()

### apps/api — Новые сервисы
- [ ] TierUnlockPurchaseService — покупка доступа к тиру за $
- [ ] SpeedUpService — ускорение цикла машины ($ или fame)

### apps/api — Удалить
- [ ] OverclockService (если есть)
- [ ] ExtendLifeService (если есть)

### Prisma schema
- [ ] Machine: добавить speedUpDays (Int, default 0) — сколько дней ускорено
- [ ] Machine: удалить overclockMultiplier (если есть)
- [ ] User: maxTierUnlocked теперь обновляется auto + purchase

### Frontend
- [ ] Удалить: Overclock UI
- [ ] Удалить: Extend Life UI
- [ ] Добавить: кнопка "Unlock Now ($X)" в магазине тиров
- [ ] Добавить: кнопка "Speed Up" на карточке машины
- [ ] Обновить: Fame panel — прогресс-бар до следующего auto-unlock
